// AUTO-GENERATED FILE - DO NOT EDIT
// This file was automatically generated by the XDK build tool.
// Any manual changes will be overwritten on the next generation.
import { execSync } from 'child_process';
import { watch } from 'chokidar';
import { spawn } from 'child_process';

console.log('ðŸš€ Starting X API SDK Documentation Watch Server...');

let serverProcess = null;

function startServer() {
  if (serverProcess) {
    serverProcess.kill();
  }
  
  console.log('ðŸ“š Starting documentation server on http://localhost:8080');
  serverProcess = spawn('npx', ['http-server', 'docs', '-p', '8080', '-o'], {
    stdio: 'inherit'
  });
}

function regenerateDocs() {
  console.log('ðŸ”„ Regenerating documentation...');
  try {
    execSync('node scripts/generate-docs-simple.js', { stdio: 'inherit' });
    console.log('âœ… Documentation regenerated successfully');
  } catch (error) {
    console.error('âŒ Failed to regenerate documentation:', error.message);
  }
}

// Initial documentation generation
regenerateDocs();
startServer();

// Watch for changes in source files
const watcher = watch([
  'src/**/*.ts',
  '!src/**/stream_client.ts',
  '!src/**/event_driven_stream.ts',
  '!src/**/stream_listener.ts',
  '!src/**/oauth1_auth.ts',
  '!src/**/oauth2_auth.ts',
  '!src/**/crypto_utils.ts'
], {
  ignored: /(^|[\/\\])\../, // ignore dotfiles
  persistent: true
});

watcher.on('change', (path) => {
  console.log(`ðŸ“ File changed: ${path}`);
  regenerateDocs();
});

watcher.on('error', (error) => {
  console.error('âŒ Watcher error:', error);
});

// Graceful shutdown
process.on('SIGINT', () => {
  console.log('\nðŸ›‘ Shutting down documentation server...');
  if (serverProcess) {
    serverProcess.kill();
  }
  watcher.close();
  process.exit(0);
});

console.log('ðŸ‘€ Watching for changes... Press Ctrl+C to stop');
